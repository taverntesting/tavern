---
$schema: "http://json-schema.org/draft-07/schema#"

title: gRPC schema
description: Schema for Python gRPC connection

type: object
additionalProperties: false
required:
  - grpc

definitions:
  grpc_request:
    type: object
    required:
      - service
    properties:
      host:
        type: string

      service:
        type: string

      body:
        type: object

      json:
        type: object

      retain:
        type: boolean

  grpc_response:
    type: object
    properties:
      status:
        oneOf:
          - type: string
          - type: integer

      details:
        type: object

      proto_body:
        type: object

      timeout:
        type: number

      verify_response_with:
        oneOf:
          - $ref: "#/definitions/verify_block"
          - type: array
            items:
              $ref: "#/definitions/verify_block"

  stage:
    properties:
      grpc_request:
        $ref: "#/definitions/grpc_request"

      grpc_response:
        $ref: "#/definitions/grpc_response"

properties:
  grpc:
    type: object
    properties:
      connect:
        type: object
        properties:
          host:
            type: string
          port:
            type: integer
          timeout:
            type: number
          keepalive:
            type: integer
          secure:
            type: boolean
            description: use a secure channel using the system default ssl certs
          options:
            description: connection options, in map format
            type: object

      # TODO
      # tls: ...

      attempt_reflection:
        description: If a gRPC definition could not be found for a service, try to use server reflection to create the gRPC call instead. This can be useful if you do not have the compiled proto definition on hand but you know what the schema is.
        type: boolean

      metadata:
        description: gRPC metadata to send to the server
        type: object

      proto:
        type: object
        properties:
          source:
            description: path to a folder containing proto definitions
            type: string
          module:
            type: string
