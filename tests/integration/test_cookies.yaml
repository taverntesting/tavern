---

test_name: Test receiving and sending cookie

includes:
  - !include common.yaml

stages:
  - name: No cookie - error
    request:
      url: "{host}/expect_cookie"
      method: GET
    response:
      status_code: 400
      body:
        error: "No cookie named tavern-cookie in request"

  - name: Expect a cookie returned
    request:
      url: "{host}/get_cookie"
      method: POST
    response:
      status_code: 200
      cookies:
        - tavern-cookie

  - name: Now we have the cookie - success
    request:
      url: "{host}/expect_cookie"
      method: GET
    response:
      status_code: 200

---

test_name: Test sending the wrong cookie when multiple are present

includes:
  - !include common.yaml

stages:
  - name: No cookie - error
    request:
      url: "{host}/expect_cookie"
      method: GET
    response:
      status_code: 400
      error: "No cookie named tavern-cookie in request"

  - &get-cookie-1
    name: Get tavern-cookie-1
    request:
      url: "{host}/get_cookie"
      method: POST
      json:
        cookie_name: tavern-cookie-1
    response:
      status_code: 200
      cookies:
        - tavern-cookie-1

  - &get-cookie-2
    name: Get tavern-cookie-2
    request:
      url: "{host}/get_cookie"
      method: POST
      json:
        cookie_name: tavern-cookie-2
    response:
      status_code: 200
      cookies:
        - tavern-cookie-2

  - name: Send the wrong cookie - error
    request:
      url: "{host}/expect_cookie"
      method: GET
      json:
        cookie_name: tavern-cookie-1
      cookies:
        - tavern-cookie-2
    response:
      status_code: 400
      error: "No cookie named tavern-cookie-1 in request"

  - name: Send the wrong cookie again - error
    request:
      url: "{host}/expect_cookie"
      method: GET
      json:
        cookie_name: tavern-cookie-2
      cookies:
        - tavern-cookie-1
    response:
      status_code: 400
      error: "No cookie named tavern-cookie-2 in request"

---

test_name: Test sending the right cookie when multiple are present

includes:
  - !include common.yaml

stages:
  - name: No cookie - error
    request:
      url: "{host}/expect_cookie"
      method: GET
    response:
      status_code: 400
      error: "No cookie named tavern-cookie in request"

  - *get-cookie-1

  - *get-cookie-2

  - name: Send the right cookie - success
    request:
      url: "{host}/expect_cookie"
      method: GET
      json:
        cookie_name: tavern-cookie-1
      cookies:
        - tavern-cookie-1
    response:
      status_code: 200

  - name: Send the right cookie - success
    request:
      url: "{host}/expect_cookie"
      method: GET
      json:
        cookie_name: tavern-cookie-2
      cookies:
        - tavern-cookie-2
    response:
      status_code: 200
